
# Fretron Assignment

A brief description of what this project does and who it's for

Objective: Develop an Express server with specified APIs and integrate it with a Google Sheets workbook.

Part 1: Express Server

- Create APIs: For user creation, organization creation, user-organization relationship management, and user permissions management.

- Implement Middleware: For authorization and validation of incoming requests.

- Deliverables: Source code, server setup instructions, and middleware explanation.

Part 2: Google Sheets Integration

- Setup Workbook: Four sheets for users, organizations, user-organization relations, and user creation.

- Integrate with Server: Fetch data from the server and handle user creation directly from the sheet.

- Deliverables: Google Sheets link, scripts, and usage instructions.
## Tech Stack


- **Node.js**: JavaScript runtime for server-side development.
- **Express.js**: Web framework for building APIs and handling server logic.
- **MongoDB**: NoSQL database for storing user and organization data.
- **Mongoose**: ODM (Object Data Modeling) library for MongoDB and Node.js.
- **Google Sheets API**: For interacting with Google Sheets from the server.
- **JavaScript**: Primary programming language for both server and client-side scripting.
- **Google Apps Script**: For scripting Google Sheets to interact with the Express server.


## Structure

```
Fretron/
├── Middleware/
│   └── auth.js
├── models/
│   ├── organization.js
│   ├── role.js
│   ├── user.js
│   ├── userOrg.js
│   └── userRole.js
├── routes/
│   ├── auth.js
│   ├── organization.js
│   └── userorg.js
├── googlesheets.js
├── server.js
├── credentials.json
└── token.json
Apps Script
```
### File Descriptions

#### Middleware

- **auth.js**: Contains the `auth`, `adminAuth`, and `roleAuth` functions for handling authorization and authentication logic.
- **JWT Token**: Used JWT to authenticate users to use the functionalities with Header name "x-auth-token".

#### Models

- **organization.js**: Contains the schema definition for the `Organization` model.
- **role.js**: Contains the schema definition for the `Role` model.
- **user.js**: Contains the schema definition for the `User` model.
- **userOrg.js**: Contains the schema definition for the `UserOrg` model, managing relationships between users and organizations.

#### Routes

- **auth.js**: Contains API endpoints related to user authentication.
- **organization.js**: Contains API endpoints for managing organizations.
- **userorg.js**: Contains API endpoints for managing user-organization relationships.

#### Other Files

- **googlesheets.js**: Contains the Google Apps Script for adding data from the Express server to Google Sheets.
- **server.js**: Main entry point for the Express server, sets up middleware, routes, and starts the server.
- **credentials.json**: Contains OAuth client credentials for authenticating with Google APIs.
- **token.json**: Generated by Google Sheets, contains the OAuth token used for accessing Google Sheets APIs.

#### Extensions

- **Apps Scripts**: Extension used from Google Sheets to make a Dashboard
## Features and Improvements

#### **Dashboard Integration**: 
Instead of just allowing user creation from the Create User Sheet, a comprehensive dashboard was created. This dashboard enables control over all actions directly within Google Sheets, streamlining the management of users, organizations, and their relationships.
#### **Custom Menu in Google Sheets**: 
Added a custom menu in Google Sheets to execute actions like:
                
`User`
  - Create User
  - Fetch Data from Express Server
  - Login
 `Organization`
  - Create Organization
  - Add User to Organization
#### **Enhanced User Management**: 
The dashboard provides an intuitive interface for managing user creation, updating user details, and managing user roles and permissions.
#### **Authorization Middleware**: 
Robust authorization middleware ensures that only users with the necessary permissions can perform certain actions, enhancing security.
#### **Error Handling**: 
Improved error handling mechanisms to provide clear and actionable error messages, helping users understand and rectify issues promptly.


## API References

#### 1. **User Signup**
   - **Endpoint:** `api/auth/signup`
   - **Method:** `POST`
   - **Description:** Creates a new user.
   - **Request Body:**
     ```json
     {
       "username": "string",
       "email": "string",
       "password": "string",
       "role": ObjectID
     }
     ```
   - **Response:**
     ```json
     {
       "msg": 'User already exists'
     }
     ```
      ```json
     {
       "msg": 'Invalid role'
     }
     ```
      ```json
     {
       "msg": 'User registered successfully'
     }
     ```

#### 2. **User Login**
   - **Endpoint:** `api/auth/login`
   - **Method:** `POST`
   - **Description:** Authenticates a user and returns a token.
   - **Request Body:**
     ```json
     {
       "email": "string",
       "password": "string"
     }
     ```
   - **Response:**
   
     ```json
     {
       {"token": token}
     }
     ```
      ```json
     {
       "msg": 'Invalid credentials'
     }
     ```

#### 3. **Create Organization**
   - **Endpoint:** `api/organization/create`
   - **Method:** `POST`
   - **Description:** Creates a new organization.
   - **Request Body:**
     ```json
     {
       "name": "string"
     }
     ```
   - **Response:**
     ```json
     {
       "msg": 'Organization created successfully'
     }
     ```

#### 4. **Add User to Organization**
   - **Endpoint:** `api/user-org/add-user-org`
   - **Method:** `POST`
   - **Description:** Adds a user to an organization.
   - **Request Body:**
     ```json
     {
       "userId": "string",
       "organizationId": "string"
     }
     ```
   - **Response:**
     ```json
     {
       "msg": 'Organization not found'
     }
     ```
      ```json
     {
       "msg": 'User not found'
     }
     ```
      ```json
     {
       "msg": 'User added to organization successfully'
     }
     ```
      ```json
     {
       "msg": 'User already in organization'
     }
     ```
## Usage Instructions

**Start the Server:**
   - Run the following command to start the server:
     ```bash
     node server.js
     ```

**Make the Port Public:**
   - Ensure that port 3000 is accessible publicly. You can do this by using VS Code’s port forwarding feature.

- *Note:* The public URL is hardcoded in the script.

**Access the Google Sheets:**
   - Open the Google Sheets document using the following link:
     [Google Sheets Document](https://docs.google.com/spreadsheets/d/1VKnW61Tb0erE8LVE6l9ZoCo8oWhkrcfpt-AWeeFLKQA/edit?usp=sharin)

**Play:**
   - You can now interact with the dashboard and control actions directly through the Google Sheets interface.



## References

[ChatGPT](https://chatgpt.com/share/0eb6b542-9983-4dae-9996-037febb65d08) : For Help in Projects

[YouTube](https://youtu.be/7H_QH9nipNs?si=GFdT4dUwRLPcRvxd) : Express JS

[Web](https://tutorial.techaltum.com/nodejs.html) : For NodeJS

[Youtube](https://youtu.be/S20PCL9e_ks?si=Kv7S5PcnnzV3uvMp) : JWT Token for Authentication (Middleware)

[Instagram](https://www.instagram.com/reel/C9HyOC6NQ8P/) : For Readme File

[YouTube](https://www.youtube.com/watch?v=Rtpu2cWz7W8) : Readme.so Tutorial